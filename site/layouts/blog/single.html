{{ define "main" }}

  <div class="blog-layout">
    {{ if .TableOfContents }}
    <!-- Sidebar TOC for large screens -->
    <aside class="toc-sidebar">
      <div class="toc-sidebar-content">
        <div class="toc-content">
          <ul>
            <li><a href="#" class="toc-title-link">{{ .Title }}</a></li>
          </ul>
          {{ .TableOfContents }}
        </div>
      </div>
    </aside>
    {{ end }}
    
    <div class="blog-main">
      <div class="mw7 center ph3 pv4">
        <h1 class="f2 lh-title b mb3" style="color: var(--circuit-blue);">{{.Title}}</h1>
        <div class="flex justify-between grey-3 mb3">
          <div>
            <p>{{ .Date.Format "Mon, Jan 2, 2006" }}</p>
            {{ with .Params.author }}<p class="ma0 f6">By {{ . }}</p>{{ end }}
          </div>
          <p>Read in {{ .ReadingTime }} minutes</p>
        </div>
        {{ with .Params.tags }}
        <div class="mb3">
          {{ range . }}
          <a href="{{ "/tags/" | relURL }}{{ . | urlize }}" class="dib mr2 mb2 pa2 br2 link" style="background: rgba(0, 174, 239, 0.1); color: var(--circuit-blue); font-size: 0.875rem;">
            #{{ . }}
          </a>
          {{ end }}
        </div>
        {{ end }}
        <div class="markdown-content mw7">
          <div>{{ .Description | markdownify }}</div>
          {{ with .Params.image }}<img src="{{ . }}" alt="{{ if $.Params.image_alt }}{{ $.Params.image_alt }}{{ else }}{{ $.Title }}{{ end }}" class="mb3" />{{ end }}
          
          {{ if .TableOfContents }}
          <!-- Mobile TOC -->
          <div class="toc-container mb4 toc-mobile">
            <h3 class="f4 lh-title b mb3" style="color: var(--circuit-blue);">Table of Contents</h3>
            <div class="toc-content">
              {{ .TableOfContents }}
            </div>
          </div>
          {{ end }}
          
          {{ .Content }}
        </div>
        
        <!-- Blog Post Navigation -->
        {{ $filteredPosts := where (where .Site.RegularPages "Section" "blog") ".Params.unlisted" "!=" "true" }}
        {{ $prev := "" }}
        {{ $next := "" }}
        {{ $found := false }}
        {{ range $index, $post := $filteredPosts }}
          {{ if eq $post.Permalink $.Permalink }}
            {{ $found = true }}
            {{ if gt $index 0 }}
              {{ $next = index $filteredPosts (sub $index 1) }}
            {{ end }}
            {{ if lt (add $index 1) (len $filteredPosts) }}
              {{ $prev = index $filteredPosts (add $index 1) }}
            {{ end }}
          {{ end }}
        {{ end }}
        
        {{ if or $prev $next }}
        <div class="section-divider"></div>
        <div class="blog-navigation">
          <div class="flex justify-between items-center">
            {{ with $prev }}
            <div class="blog-nav-item blog-nav-prev">
              <a href="{{ .Permalink }}" class="flex items-center">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mr2">
                  <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div>
                  <div class="blog-nav-label">Older Post</div>
                  <div class="blog-nav-title">{{ .Title }}</div>
                  <div class="blog-nav-date">{{ .Date.Format "Jan 2, 2006" }}</div>
                </div>
              </a>
            </div>
            {{ else }}
            <div></div>
            {{ end }}
            
            {{ with $next }}
            <div class="blog-nav-item blog-nav-next">
              <a href="{{ .Permalink }}" class="flex items-center">
                <div class="text-right">
                  <div class="blog-nav-label">Newer Post</div>
                  <div class="blog-nav-title">{{ .Title }}</div>
                  <div class="blog-nav-date">{{ .Date.Format "Jan 2, 2006" }}</div>
                </div>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="ml2">
                  <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </div>
            {{ else }}
            <div></div>
            {{ end }}
          </div>
        </div>
        {{ end }}
        
        <!-- Return to top button -->
        <button id="return-to-top" class="return-to-top" aria-label="Return to table of contents">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 14L12 9L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
{{ end }}
